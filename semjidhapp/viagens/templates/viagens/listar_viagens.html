{% extends 'viagens/base_generic.html' %}

{% block title %}SEMJIDH - Listar Viagens{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="text-dark">Lista de Viagens</h2>
  <ul class="list-group">
    {% for viagem in page_obj %}
      <li class="list-group-item bg-light text-dark mb-3">
        <div class="row">
          <!-- Coluna da Esquerda -->
          <div class="col-md-6">
            <h5>
              {{ viagem.destino }} – {{ viagem.data_ida }} – {{ viagem.setor }} - {{ viagem.veiculo }}
              {% if viagem.status == "Concluída" or viagem.status == "Atribuída" %}
                <span class="badge bg-success">{{ viagem.status }}</span>
              {% else %}
                <span class="badge bg-warning">{{ viagem.status }}</span>
              {% endif %}
            </h5>

            <p class="mb-1"><strong>Servidores:</strong></p>
            <ul class="list-unstyled ms-3">
              {% for servidor in viagem.servidores_lista %}
                <li class="text-dark">{{ servidor }}</li>
              {% endfor %}
            </ul>
            
            <p class="mb-1"><strong>Solicitada em:</strong> {{ viagem.criada_em|date:"d/m/Y H:i" }}</p>

            <p class="mb-1">
              <strong>Processo:</strong> {{ viagem.processo|default:"Processo não informado" }}
            </p>

            {% if viagem.motorista %}
              <p class="mt-2"><strong>Data de Volta:</strong> {{ viagem.data_volta }}</p>
            {% endif %}
          </div>

          <!-- Coluna da Direita -->
          <div class="col-md-6">
            <p class="mb-1">
              <strong>Horário de ida:</strong> {{ viagem.horario_ida|default:"Não definido" }}
            </p>
            <p class="mb-1">
              <strong>Previsão da volta:</strong> {{ viagem.horario_volta|default:"Não definido" }}
            </p>

            {% if not viagem.motorista %}
              <p class="mt-2"><strong>Data de Volta:</strong> {{ viagem.data_volta }}</p>
            {% endif %}

            {% if viagem.motorista %}
              <p class="mt-2"><strong>Motorista Atribuído:</strong> {{ viagem.motorista.nome }}</p>
              {% if viagem.veiculo %}
                <p class="mt-2"><strong>Carro Designado:</strong> {{ viagem.carro }}</p>
              <p class="mt-2"><strong>Local de Saída:</strong> {{ viagem.local_partida }}</p>
              {% endif %}
              
              {% if not viagem.veiculo %}
                <a href="{% url 'designar_carro' viagem.id %}" class="btn btn-info btn-sm mt-2">
                  Designar Carro
                </a>
              {% else %}
                <a href="{% url 'designar_carro' viagem.id %}" class="btn btn-secondary btn-sm mt-2">
                  Alterar Carro
                </a>
              {% endif %}
              
            {% else %}
              <a href="{% url 'designar_motorista' viagem.id %}" class="btn btn-primary btn-sm mt-2">
                Designar Motorista
              </a>
            {% endif %}

            {% if viagem.motorista %}
              <a href="{% url 'designar_motorista' viagem.id %}" class="btn btn-secondary btn-sm mt-2">
                Alterar Motorista
              </a>
            {% endif %}

            <form action="{% url 'apagar_viagem' viagem.id %}" method="post" class="mt-2">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm">Apagar Viagem</button>
            </form>
          </div>
        </div>
      </li>
    {% endfor %}
  </ul>

  <!-- Navegação da página -->
  <div class="d-flex justify-content-between align-items-center mt-3">
    <div>
      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-outline-primary btn-sm">Anterior</a>
      {% endif %}
      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="btn btn-outline-primary btn-sm">Próxima</a>
      {% endif %}
    </div>

    <div>
      <form method="get">
        <label for="page_select">Ir para a página:</label>
        <select id="page_select" name="page" onchange="this.form.submit()" class="form-select d-inline w-auto">
          {% for i in paginator.page_range %}
            <option value="{{ i }}" {% if page_obj.number == i %}selected{% endif %}>{{ i }}</option>
          {% endfor %}
        </select>
      </form>
    </div>
  </div>
</div>
{% endblock %}